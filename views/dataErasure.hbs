<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OWASP Juice Shop</title>
<link rel='icon' type='image/x-icon' href="./assets/public/images/JuiceShop_Logo_50px.png">
<link rel="stylesheet" href='https://code.getmdl.io/1.3.0/material.min.css'>
<link rel="stylesheet" href='https://fonts.googleapis.com/icon?family=Material+Icons'>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700', type='text/css'>
<style>
    body{
        background-color: #303030;
    }
    .main-content{
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
    }
    .form{
        margin-top: 50px;
        background-color: #424242;
        width: 600px;
        height: 370px;
        border-radius: .5rem;
        padding: 10px;
        box-shadow: 5px 10px 18px #202020;
    }
    form{
        margin-top: 40px;
        display: grid;
    }
    h4,p,h5{
        color: white;
    }
    input {
        width:520px;
        height: 45px;
        border-radius: .4rem;
        margin-left:5px;
        background-color: #424242;
        border:1px solid #999898;
        margin-bottom: 20px;
        color: white;
    }
    input:hover{
        cursor: text;
    }
    button{
        width: 200px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #546e7a;
        color: whitesmoke;
        border-radius: .2rem;
        margin-left: 200px;
        font-weight:500;
        box-shadow: 1px 1px 1px 1px #302f2f;
        font-size: 18px;
    }
    #ansBlock{
        display: none;
    }
    input::placeholder {
        color: #999898;
        font-size: 13px;
    }
    .header{
        height: auto;
        color: whitesmoke;
        font-size: 25px;
        box-shadow: 5px 10px 18px #201f1f;
        background-color: #546e7a;;
    }
    .header-text{
        font-size: 20px;
        padding-top: 10px;
        margin-top:10px;
        font-weight: 500;
    }
    a{
        color: whitesmoke;
        text-decoration: none;
        padding-top: 10px;
    }
    img{
        width: 50px;
        height: 60px;
    }
    label{
        font-size: 10px;
        height: 20px;
        width: 500px !important;
    }
    .message{
        display: flex;
        justify-content: center;
        padding-top: 60px;
        font-size: 19px;
        width: 100%;
    }
    .inputLable{
        height: 20px;
        width: 500px !important;
    }
    .home-page{
        margin-top: 30px;
    }
    img{
        padding-top: 5px;
        padding-left: 50px;
    }
    .back{
        position: absolute;
        font-size: 15px;
        top: 8px;
    } 
    label{
        color:white;
        font-size:15px;
    }

    #email{
        margin-left: 19px;
    }

    #ans{
        margin-left: 5px;
    }

    i{
        margin-left: 20px;
        margin-right: 5px;
    }
    .anchor{
        font-size: 15px;
    }
</style>
<div class="header">
    <a href="./#/"><i class='material-icons'>arrow_back</i></a>
    <a href="./#/" class="back"><span>Back</span></a>
    <a href="./#/" class=""><img src="./assets/public/images/JuiceShop_Logo.png" alt=""></a>
    <a href="./#/"><span class="header-text">OWASP Juice Shop</span></a>
</div>
{{#if email}}
<div class="main-content">
	<div class="form">
		<p class="message">Sorry to see you leave! Your erasure request will be processed shortly.</p>
        <button class="home-page mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="background-color:#546E7A; color: #FFFFFF; margin-left:200px;">Go To HomePage</button>
    </div>			
</div>
<script>
    let button = document.querySelector('button')
    localStorage.removeItem('token')
    sessionStorage.removeItem('bid')
    // delete token cookie
    var href = window.location.href
    href = href.replace("/dataerasure", "/#/");
    Cookies.remove("token");
    button.addEventListener('click', (event) => {
        window.location.replace(href)
    })
</script>
{{else}}
<div class="main-content">
    <div class="form">
    <h4>Data Erasure Request (Art. 17 GDPR)</h4>
    <p>We take data security, customer privacy, and legal compliance very serious. In accordance with GDPR we allow you to request complete erasure of your account and any associated data.</p>
    <h5>Request Data Erasure</h5>
    <form onsubmit='return onSubmit(this)'>
    <div>
    <label for="email" class="inputLable">Email</label>
	<input type="email" placeholder={{Email}} name="email" id="email">
	</div>
	<div id="ansBlock">
    <label for="ans" class="inputLable">Answer</label>
	<input type="text" placeholder="{{securityQuestion}}" id="ans">
	</div>
    <button type="submit" class="deleteButton mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="background-color:#546E7A; color: #FFFFFF; margin-left:200px;">Delete User Data</button>
    </form>
</div>
<script type="text/javascript">
let email = document.getElementById("email");
let ans = document.getElementById("ans")
let ansBlock = document.getElementById("ansBlock")
let deleteButton = document.querySelector("button");
deleteButton.disabled = true;
email.addEventListener("change", stateHandle);
function stateHandle() {
ansBlock.style = "display:block;"
ans.addEventListener("change", stateHandle);
    if (email.value === "" || ans.value === "") {
        deleteButton.disabled = true;
    } else {
        deleteButton.disabled = false;
    }
}
function onSubmit( form ){
    var data = $(form).serializeArray();
    var formObject = { profile : {} };
	    $.each(data,
			function(i, v) {
		    formObject.profile[v.name] = v.value;
		    });
		$.ajax({
		    type: 'POST',
		    url: window.location.href,
			data: JSON.stringify(formObject),
		    success: function(data, textStatus, jqXHR) { 
				document.write(jqXHR.responseText); 
		    },
            contentType: "application/json",
		    dataType: 'html'
			});
			return false;
        }   
  </script>   
{{/if}}
